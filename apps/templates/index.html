<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n de Canchas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .tab-button {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            cursor: pointer;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .tab-button.active {
            background: white;
            color: #667eea;
            border-color: white;
        }

        .tab-content {
            display: none;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .tab-content.active {
            display: block;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .section-title {
            font-size: 1.8em;
            color: #333;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #229954;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: #667eea;
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        tr:hover {
            background: #f5f5f5;
        }

        .form-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .actions {
            display: flex;
            gap: 10px;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèÜ Gesti√≥n de Canchas</h1>
        
        <div class="tabs">
            <button class="tab-button active" onclick="showTab('clientes')">Clientes</button>
            <button class="tab-button" onclick="showTab('canchas')">Canchas</button>
            <button class="tab-button" onclick="showTab('reservas')">Reservas</button>
            <button class="tab-button" onclick="showTab('pagos')">Pagos</button>
            <button class="tab-button" onclick="showTab('torneos')">Torneos</button>
            <button class="tab-button" onclick="showTab('tipos-cancha')">Tipos Cancha</button>
            <button class="tab-button" onclick="showTab('servicios')">Servicios</button>
            <button class="tab-button" onclick="showTab('metodos-pago')">M√©todos Pago</button>
        </div>

        <!-- TAB CLIENTES -->
        <div id="clientes" class="tab-content active">
            <div class="section-header">
                <h2 class="section-title">Clientes</h2>
                <button class="btn btn-primary" onclick="showForm('cliente')">+ Agregar Cliente</button>
            </div>
            
            <div id="form-cliente" class="form-container" style="display: none;">
                <h3>Nuevo Cliente</h3>
                <form onsubmit="guardarCliente(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label>DNI</label>
                            <input type="number" id="cliente-dni" required>
                        </div>
                        <div class="form-group">
                            <label>Nombre</label>
                            <input type="text" id="cliente-nombre" required>
                        </div>
                        <div class="form-group">
                            <label>Apellido</label>
                            <input type="text" id="cliente-apellido" required>
                        </div>
                        <div class="form-group">
                            <label>Tel√©fono</label>
                            <input type="text" id="cliente-telefono" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-success">Guardar</button>
                    <button type="button" class="btn btn-danger" onclick="cancelarForm('cliente')">Cancelar</button>
                </form>
            </div>

            <div id="clientes-table-container">
                <div class="loading">Cargando...</div>
            </div>
        </div>

        <!-- TAB CANCHAS -->
        <div id="canchas" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">Canchas</h2>
                <button class="btn btn-primary" onclick="showForm('cancha')">+ Agregar Cancha</button>
            </div>
            
            <div id="form-cancha" class="form-container" style="display: none;">
                <h3>Nueva Cancha</h3>
                <form onsubmit="guardarCancha(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Tipo de Cancha (ID)</label>
                            <input type="number" id="cancha-id-tipo" required>
                        </div>
                        <div class="form-group">
                            <label>Costo por Hora</label>
                            <input type="number" step="0.01" id="cancha-costo" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-success">Guardar</button>
                    <button type="button" class="btn btn-danger" onclick="cancelarForm('cancha')">Cancelar</button>
                </form>
            </div>

            <div id="canchas-table-container">
                <div class="loading">Cargando...</div>
            </div>
        </div>

        <!-- TAB RESERVAS -->
        <div id="reservas" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">Reservas</h2>
                <button class="btn btn-primary" onclick="showForm('reserva')">+ Agregar Reserva</button>
            </div>
            
            <div id="form-reserva" class="form-container" style="display: none;">
                <h3>Nueva Reserva</h3>
                <form onsubmit="guardarReserva(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Fecha y Hora Inicio</label>
                            <input type="datetime-local" id="reserva-fecha" required>
                        </div>
                        <div class="form-group">
                            <label>Horas</label>
                            <input type="number" id="reserva-horas" required>
                        </div>
                        <div class="form-group">
                            <label>Nro. Cancha</label>
                            <input type="number" id="reserva-cancha" required>
                        </div>
                        <div class="form-group">
                            <label>DNI Cliente</label>
                            <input type="number" id="reserva-cliente" required>
                        </div>
                        <div class="form-group">
                            <label>ID Pago</label>
                            <input type="number" id="reserva-pago">
                        </div>
                        <div class="form-group">
                            <label>ID Estado</label>
                            <input type="number" id="reserva-estado" value="1">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-success">Guardar</button>
                    <button type="button" class="btn btn-danger" onclick="cancelarForm('reserva')">Cancelar</button>
                </form>
            </div>

            <div id="reservas-table-container">
                <div class="loading">Cargando...</div>
            </div>
        </div>

        <!-- TAB PAGOS -->
        <div id="pagos" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">Pagos</h2>
                <button class="btn btn-primary" onclick="showForm('pago')">+ Agregar Pago</button>
            </div>
            
            <div id="form-pago" class="form-container" style="display: none;">
                <h3>Nuevo Pago</h3>
                <form onsubmit="guardarPago(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label>ID M√©todo Pago</label>
                            <input type="number" id="pago-metodo" required>
                        </div>
                        <div class="form-group">
                            <label>Fecha y Hora</label>
                            <input type="datetime-local" id="pago-fecha" required>
                        </div>
                        <div class="form-group">
                            <label>Monto</label>
                            <input type="number" step="0.01" id="pago-monto" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-success">Guardar</button>
                    <button type="button" class="btn btn-danger" onclick="cancelarForm('pago')">Cancelar</button>
                </form>
            </div>

            <div id="pagos-table-container">
                <div class="loading">Cargando...</div>
            </div>
        </div>

        <!-- TAB TORNEOS -->
        <div id="torneos" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">Torneos</h2>
                <button class="btn btn-primary" onclick="showForm('torneo')">+ Agregar Torneo</button>
            </div>
            
            <div id="form-torneo" class="form-container" style="display: none;">
                <h3>Nuevo Torneo</h3>
                <form onsubmit="guardarTorneo(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Fecha Inicio</label>
                            <input type="datetime-local" id="torneo-inicio" required>
                        </div>
                        <div class="form-group">
                            <label>Fecha Fin</label>
                            <input type="datetime-local" id="torneo-fin" required>
                        </div>
                        <div class="form-group">
                            <label>Costo Inscripci√≥n</label>
                            <input type="number" step="0.01" id="torneo-costo" required>
                        </div>
                        <div class="form-group">
                            <label>Premio</label>
                            <input type="number" step="0.01" id="torneo-premio" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-success">Guardar</button>
                    <button type="button" class="btn btn-danger" onclick="cancelarForm('torneo')">Cancelar</button>
                </form>
            </div>

            <div id="torneos-table-container">
                <div class="loading">Cargando...</div>
            </div>
        </div>

        <!-- TAB TIPOS CANCHA -->
        <div id="tipos-cancha" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">Tipos de Cancha</h2>
                <button class="btn btn-primary" onclick="showForm('tipo-cancha')">+ Agregar Tipo</button>
            </div>
            
            <div id="form-tipo-cancha" class="form-container" style="display: none;">
                <h3>Nuevo Tipo de Cancha</h3>
                <form onsubmit="guardarTipoCancha(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Tipo</label>
                            <input type="text" id="tipo-cancha-nombre" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-success">Guardar</button>
                    <button type="button" class="btn btn-danger" onclick="cancelarForm('tipo-cancha')">Cancelar</button>
                </form>
            </div>

            <div id="tipos-cancha-table-container">
                <div class="loading">Cargando...</div>
            </div>
        </div>

        <!-- TAB SERVICIOS -->
        <div id="servicios" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">Servicios</h2>
                <button class="btn btn-primary" onclick="showForm('servicio')">+ Agregar Servicio</button>
            </div>
            
            <div id="form-servicio" class="form-container" style="display: none;">
                <h3>Nuevo Servicio</h3>
                <form onsubmit="guardarServicio(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Servicio</label>
                            <input type="text" id="servicio-nombre" required>
                        </div>
                        <div class="form-group">
                            <label>Costo</label>
                            <input type="number" step="0.01" id="servicio-costo" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-success">Guardar</button>
                    <button type="button" class="btn btn-danger" onclick="cancelarForm('servicio')">Cancelar</button>
                </form>
            </div>

            <div id="servicios-table-container">
                <div class="loading">Cargando...</div>
            </div>
        </div>

        <!-- TAB M√âTODOS PAGO -->
        <div id="metodos-pago" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">M√©todos de Pago</h2>
                <button class="btn btn-primary" onclick="showForm('metodo-pago')">+ Agregar M√©todo</button>
            </div>
            
            <div id="form-metodo-pago" class="form-container" style="display: none;">
                <h3>Nuevo M√©todo de Pago</h3>
                <form onsubmit="guardarMetodoPago(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label>M√©todo</label>
                            <input type="text" id="metodo-pago-nombre" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-success">Guardar</button>
                    <button type="button" class="btn btn-danger" onclick="cancelarForm('metodo-pago')">Cancelar</button>
                </form>
            </div>

            <div id="metodos-pago-table-container">
                <div class="loading">Cargando...</div>
            </div>
        </div>
    </div>

    <script>
        // Validaciones reutilizables
        const Validaciones = {
            esNumeroPositivo: (valor, nombreCampo) => {
                const num = parseFloat(valor);
                if (isNaN(num) || num <= 0) {
                    return `${nombreCampo} debe ser un n√∫mero positivo`;
                }
                return null;
            },
            
            esEnteroPositivo: (valor, nombreCampo) => {
                const num = parseInt(valor);
                if (isNaN(num) || num <= 0 || !Number.isInteger(num)) {
                    return `${nombreCampo} debe ser un n√∫mero entero positivo`;
                }
                return null;
            },
            
            esDNIValido: (dni) => {
                const num = parseInt(dni);
                if (isNaN(num) || num < 1000000 || num > 99999999) {
                    return 'El DNI debe tener entre 7 y 8 d√≠gitos';
                }
                return null;
            },
            
            esTelefonoValido: (telefono) => {
                const regex = /^[0-9]{7,15}$/;
                if (!regex.test(telefono.replace(/[\s-]/g, ''))) {
                    return 'El tel√©fono debe contener entre 7 y 15 d√≠gitos';
                }
                return null;
            },
            
            esTextoValido: (texto, nombreCampo, minLength = 2, maxLength = 100) => {
                const trimmed = texto.trim();
                if (trimmed.length < minLength) {
                    return `${nombreCampo} debe tener al menos ${minLength} caracteres`;
                }
                if (trimmed.length > maxLength) {
                    return `${nombreCampo} no puede exceder ${maxLength} caracteres`;
                }
                if (!/^[a-zA-Z√°√©√≠√≥√∫√Å√â√ç√ì√ö√±√ë\s]+$/.test(trimmed)) {
                    return `${nombreCampo} solo puede contener letras y espacios`;
                }
                return null;
            },
            
            esFechaValida: (fecha, nombreCampo) => {
                if (!fecha) {
                    return `${nombreCampo} es requerida`;
                }
                const fechaObj = new Date(fecha);
                if (isNaN(fechaObj.getTime())) {
                    return `${nombreCampo} no es v√°lida`;
                }
                return null;
            },
            
            esFechaFutura: (fecha, nombreCampo) => {
                const error = Validaciones.esFechaValida(fecha, nombreCampo);
                if (error) return error;
                
                const fechaObj = new Date(fecha);
                const ahora = new Date();
                if (fechaObj < ahora) {
                    return `${nombreCampo} debe ser una fecha futura`;
                }
                return null;
            },
            
            esFechaPosterior: (fechaInicio, fechaFin) => {
                const inicio = new Date(fechaInicio);
                const fin = new Date(fechaFin);
                if (fin <= inicio) {
                    return 'La fecha de fin debe ser posterior a la fecha de inicio';
                }
                return null;
            },
            
            mostrarErrores: (errores) => {
                if (errores.length > 0) {
                    alert('Errores de validaci√≥n:\n\n' + errores.join('\n'));
                    return true;
                }
                return false;
            }
        };

        // Funciones de navegaci√≥n
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Cargar datos al cambiar de tab
            loadTabData(tabName);
        }

        function showForm(type) {
            document.getElementById(`form-${type}`).style.display = 'block';
        }

        function cancelarForm(type) {
            document.getElementById(`form-${type}`).style.display = 'none';
            document.getElementById(`form-${type}`).querySelector('form').reset();
        }

        // Funciones de carga de datos
        async function loadTabData(tabName) {
            const endpoints = {
                'clientes': '/api/clientes',
                'canchas': '/api/canchas',
                'reservas': '/api/reservas',
                'pagos': '/api/pagos',
                'torneos': '/api/torneos',
                'tipos-cancha': '/api/tipos-cancha',
                'servicios': '/api/servicios',
                'metodos-pago': '/api/metodos-pago'
            };

            const containers = {
                'clientes': 'clientes-table-container',
                'canchas': 'canchas-table-container',
                'reservas': 'reservas-table-container',
                'pagos': 'pagos-table-container',
                'torneos': 'torneos-table-container',
                'tipos-cancha': 'tipos-cancha-table-container',
                'servicios': 'servicios-table-container',
                'metodos-pago': 'metodos-pago-table-container'
            };

            const renderers = {
                'clientes': renderClientes,
                'canchas': renderCanchas,
                'reservas': renderReservas,
                'pagos': renderPagos,
                'torneos': renderTorneos,
                'tipos-cancha': renderTiposCancha,
                'servicios': renderServicios,
                'metodos-pago': renderMetodosPago
            };

            try {
                const response = await fetch(endpoints[tabName]);
                const data = await response.json();
                const container = document.getElementById(containers[tabName]);
                renderers[tabName](data, container);
            } catch (error) {
                document.getElementById(containers[tabName]).innerHTML = 
                    `<div class="empty-state">Error al cargar datos: ${error.message}</div>`;
            }
        }

        // Renderizadores de tablas
        function renderClientes(data, container) {
            if (!Array.isArray(data)) {
                container.innerHTML = `<div class="empty-state">Error: ${data.error || 'Formato de datos inv√°lido'}</div>`;
                return;
            }
            if (data.length === 0) {
                container.innerHTML = '<div class="empty-state">No hay clientes registrados</div>';
                return;
            }
            let html = '<table><thead><tr><th>DNI</th><th>Nombre</th><th>Apellido</th><th>Tel√©fono</th><th>Acciones</th></tr></thead><tbody>';
            data.forEach(cliente => {
                html += `<tr>
                    <td>${cliente.dni}</td>
                    <td>${cliente.nombre}</td>
                    <td>${cliente.apellido}</td>
                    <td>${cliente.telefono}</td>
                    <td><button class="btn btn-danger" onclick="eliminarCliente(${cliente.dni})">Eliminar</button></td>
                </tr>`;
            });
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function renderCanchas(data, container) {
            if (!Array.isArray(data)) {
                container.innerHTML = `<div class="empty-state">Error: ${data.error || 'Formato de datos inv√°lido'}</div>`;
                return;
            }
            if (data.length === 0) {
                container.innerHTML = '<div class="empty-state">No hay canchas registradas</div>';
                return;
            }
            let html = '<table><thead><tr><th>Nro. Cancha</th><th>ID Tipo</th><th>Costo por Hora</th><th>Acciones</th></tr></thead><tbody>';
            data.forEach(cancha => {
                html += `<tr>
                    <td>${cancha.nro_cancha}</td>
                    <td>${cancha.id_tipo}</td>
                    <td>$${cancha.costo_por_hora}</td>
                    <td><button class="btn btn-danger" onclick="eliminarCancha(${cancha.nro_cancha})">Eliminar</button></td>
                </tr>`;
            });
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function renderReservas(data, container) {
            if (!Array.isArray(data)) {
                container.innerHTML = `<div class="empty-state">Error: ${data.error || 'Formato de datos inv√°lido'}</div>`;
                return;
            }
            if (data.length === 0) {
                container.innerHTML = '<div class="empty-state">No hay reservas registradas</div>';
                return;
            }
            let html = '<table><thead><tr><th>Nro. Reserva</th><th>Fecha Inicio</th><th>Horas</th><th>Cancha</th><th>Cliente</th><th>Estado</th><th>Acciones</th></tr></thead><tbody>';
            data.forEach(reserva => {
                html += `<tr>
                    <td>${reserva.nro_reserva}</td>
                    <td>${reserva.fecha_hora_inicio}</td>
                    <td>${reserva.horas}</td>
                    <td>${reserva.nro_cancha}</td>
                    <td>${reserva.dni_cliente}</td>
                    <td>${reserva.id_estado}</td>
                    <td><button class="btn btn-danger" onclick="eliminarReserva(${reserva.nro_reserva})">Eliminar</button></td>
                </tr>`;
            });
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function renderPagos(data, container) {
            if (!Array.isArray(data)) {
                container.innerHTML = `<div class="empty-state">Error: ${data.error || 'Formato de datos inv√°lido'}</div>`;
                return;
            }
            if (data.length === 0) {
                container.innerHTML = '<div class="empty-state">No hay pagos registrados</div>';
                return;
            }
            let html = '<table><thead><tr><th>ID Pago</th><th>M√©todo</th><th>Fecha</th><th>Monto</th></tr></thead><tbody>';
            data.forEach(pago => {
                html += `<tr>
                    <td>${pago.id_pago}</td>
                    <td>${pago.id_metodo_pago}</td>
                    <td>${pago.fecha_hora}</td>
                    <td>$${pago.monto}</td>
                </tr>`;
            });
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function renderTorneos(data, container) {
            if (!Array.isArray(data)) {
                container.innerHTML = `<div class="empty-state">Error: ${data.error || 'Formato de datos inv√°lido'}</div>`;
                return;
            }
            if (data.length === 0) {
                container.innerHTML = '<div class="empty-state">No hay torneos registrados</div>';
                return;
            }
            let html = '<table><thead><tr><th>ID</th><th>Fecha Inicio</th><th>Fecha Fin</th><th>Costo Inscripci√≥n</th><th>Premio</th><th>Acciones</th></tr></thead><tbody>';
            data.forEach(torneo => {
                html += `<tr>
                    <td>${torneo.id}</td>
                    <td>${torneo.fecha_inicio}</td>
                    <td>${torneo.fecha_fin}</td>
                    <td>$${torneo.costo_inscripcion}</td>
                    <td>$${torneo.premio}</td>
                    <td><button class="btn btn-danger" onclick="eliminarTorneo(${torneo.id})">Eliminar</button></td>
                </tr>`;
            });
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function renderTiposCancha(data, container) {
            if (!Array.isArray(data)) {
                container.innerHTML = `<div class="empty-state">Error: ${data.error || 'Formato de datos inv√°lido'}</div>`;
                return;
            }
            if (data.length === 0) {
                container.innerHTML = '<div class="empty-state">No hay tipos de cancha registrados</div>';
                return;
            }
            let html = '<table><thead><tr><th>ID</th><th>Tipo</th></tr></thead><tbody>';
            data.forEach(tipo => {
                html += `<tr>
                    <td>${tipo.id_tipo}</td>
                    <td>${tipo.tipo}</td>
                </tr>`;
            });
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function renderServicios(data, container) {
            if (!Array.isArray(data)) {
                container.innerHTML = `<div class="empty-state">Error: ${data.error || 'Formato de datos inv√°lido'}</div>`;
                return;
            }
            if (data.length === 0) {
                container.innerHTML = '<div class="empty-state">No hay servicios registrados</div>';
                return;
            }
            let html = '<table><thead><tr><th>ID</th><th>Servicio</th><th>Costo</th></tr></thead><tbody>';
            data.forEach(servicio => {
                html += `<tr>
                    <td>${servicio.id_servicio}</td>
                    <td>${servicio.servicio}</td>
                    <td>$${servicio.costo}</td>
                </tr>`;
            });
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function renderMetodosPago(data, container) {
            if (!Array.isArray(data)) {
                container.innerHTML = `<div class="empty-state">Error: ${data.error || 'Formato de datos inv√°lido'}</div>`;
                return;
            }
            if (data.length === 0) {
                container.innerHTML = '<div class="empty-state">No hay m√©todos de pago registrados</div>';
                return;
            }
            let html = '<table><thead><tr><th>ID</th><th>M√©todo</th></tr></thead><tbody>';
            data.forEach(metodo => {
                html += `<tr>
                    <td>${metodo.id_metodo_pago}</td>
                    <td>${metodo.metodo}</td>
                </tr>`;
            });
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // Funciones de guardado
        async function guardarCliente(event) {
            event.preventDefault();
            
            const dni = document.getElementById('cliente-dni').value;
            const nombre = document.getElementById('cliente-nombre').value;
            const apellido = document.getElementById('cliente-apellido').value;
            const telefono = document.getElementById('cliente-telefono').value;
            
            const errores = [];
            
            const errorDNI = Validaciones.esDNIValido(dni);
            if (errorDNI) errores.push(errorDNI);
            
            const errorNombre = Validaciones.esTextoValido(nombre, 'Nombre');
            if (errorNombre) errores.push(errorNombre);
            
            const errorApellido = Validaciones.esTextoValido(apellido, 'Apellido');
            if (errorApellido) errores.push(errorApellido);
            
            const errorTelefono = Validaciones.esTelefonoValido(telefono);
            if (errorTelefono) errores.push(errorTelefono);
            
            if (Validaciones.mostrarErrores(errores)) return;
            
            const data = {
                dni: parseInt(dni),
                nombre: nombre.trim(),
                apellido: apellido.trim(),
                telefono: telefono.replace(/[\s-]/g, '')
            };
            try {
                const response = await fetch('/api/clientes', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                if (response.ok) {
                    alert('Cliente agregado exitosamente');
                    cancelarForm('cliente');
                    loadTabData('clientes');
                } else {
                    const error = await response.json();
                    alert('Error: ' + error.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function guardarCancha(event) {
            event.preventDefault();
            
            const idTipo = document.getElementById('cancha-id-tipo').value;
            const costo = document.getElementById('cancha-costo').value;
            
            const errores = [];
            
            const errorIdTipo = Validaciones.esEnteroPositivo(idTipo, 'ID del tipo de cancha');
            if (errorIdTipo) errores.push(errorIdTipo);
            
            const errorCosto = Validaciones.esNumeroPositivo(costo, 'Costo por hora');
            if (errorCosto) errores.push(errorCosto);
            
            if (Validaciones.mostrarErrores(errores)) return;
            
            const data = {
                id_tipo: parseInt(idTipo),
                costo_por_hora: parseFloat(costo)
            };
            try {
                const response = await fetch('/api/canchas', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                if (response.ok) {
                    alert('Cancha agregada exitosamente');
                    cancelarForm('cancha');
                    loadTabData('canchas');
                } else {
                    const error = await response.json();
                    alert('Error: ' + error.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function guardarReserva(event) {
            event.preventDefault();
            
            const fecha = document.getElementById('reserva-fecha').value;
            const horas = document.getElementById('reserva-horas').value;
            const nroCancha = document.getElementById('reserva-cancha').value;
            const dniCliente = document.getElementById('reserva-cliente').value;
            const idPago = document.getElementById('reserva-pago').value;
            const idEstado = document.getElementById('reserva-estado').value;
            
            const errores = [];
            
            const errorFecha = Validaciones.esFechaFutura(fecha, 'Fecha y hora de inicio');
            if (errorFecha) errores.push(errorFecha);
            
            const errorHoras = Validaciones.esEnteroPositivo(horas, 'Cantidad de horas');
            if (errorHoras) errores.push(errorHoras);
            else if (parseInt(horas) > 12) errores.push('La cantidad de horas no puede exceder 12');
            
            const errorCancha = Validaciones.esEnteroPositivo(nroCancha, 'N√∫mero de cancha');
            if (errorCancha) errores.push(errorCancha);
            
            const errorCliente = Validaciones.esDNIValido(dniCliente);
            if (errorCliente) errores.push(errorCliente);
            
            if (Validaciones.mostrarErrores(errores)) return;
            
            const data = {
                fecha_hora_inicio: fecha,
                horas: parseInt(horas),
                nro_cancha: parseInt(nroCancha),
                dni_cliente: parseInt(dniCliente),
                id_pago: idPago ? parseInt(idPago) : null,
                id_estado: idEstado ? parseInt(idEstado) : 1
            };
            try {
                const response = await fetch('/api/reservas', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                if (response.ok) {
                    alert('Reserva agregada exitosamente');
                    cancelarForm('reserva');
                    loadTabData('reservas');
                } else {
                    const error = await response.json();
                    alert('Error: ' + error.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function guardarPago(event) {
            event.preventDefault();
            
            const idMetodo = document.getElementById('pago-metodo').value;
            const fecha = document.getElementById('pago-fecha').value;
            const monto = document.getElementById('pago-monto').value;
            
            const errores = [];
            
            const errorMetodo = Validaciones.esEnteroPositivo(idMetodo, 'ID del m√©todo de pago');
            if (errorMetodo) errores.push(errorMetodo);
            
            const errorFecha = Validaciones.esFechaValida(fecha, 'Fecha y hora del pago');
            if (errorFecha) errores.push(errorFecha);
            
            const errorMonto = Validaciones.esNumeroPositivo(monto, 'Monto');
            if (errorMonto) errores.push(errorMonto);
            
            if (Validaciones.mostrarErrores(errores)) return;
            
            const data = {
                id_metodo_pago: parseInt(idMetodo),
                fecha_hora: fecha,
                monto: parseFloat(monto)
            };
            try {
                const response = await fetch('/api/pagos', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                if (response.ok) {
                    alert('Pago agregado exitosamente');
                    cancelarForm('pago');
                    loadTabData('pagos');
                } else {
                    const error = await response.json();
                    alert('Error: ' + error.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function guardarTorneo(event) {
            event.preventDefault();
            
            const fechaInicio = document.getElementById('torneo-inicio').value;
            const fechaFin = document.getElementById('torneo-fin').value;
            const costoInscripcion = document.getElementById('torneo-costo').value;
            const premio = document.getElementById('torneo-premio').value;
            
            const errores = [];
            
            const errorInicio = Validaciones.esFechaFutura(fechaInicio, 'Fecha de inicio');
            if (errorInicio) errores.push(errorInicio);
            
            const errorFin = Validaciones.esFechaValida(fechaFin, 'Fecha de fin');
            if (errorFin) errores.push(errorFin);
            
            if (!errorInicio && !errorFin) {
                const errorPosterior = Validaciones.esFechaPosterior(fechaInicio, fechaFin);
                if (errorPosterior) errores.push(errorPosterior);
            }
            
            const errorCosto = Validaciones.esNumeroPositivo(costoInscripcion, 'Costo de inscripci√≥n');
            if (errorCosto) errores.push(errorCosto);
            
            const errorPremio = Validaciones.esNumeroPositivo(premio, 'Premio');
            if (errorPremio) errores.push(errorPremio);
            
            if (Validaciones.mostrarErrores(errores)) return;
            
            const data = {
                fecha_inicio: fechaInicio,
                fecha_fin: fechaFin,
                costo_inscripcion: parseFloat(costoInscripcion),
                premio: parseFloat(premio)
            };
            try {
                const response = await fetch('/api/torneos', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                if (response.ok) {
                    alert('Torneo agregado exitosamente');
                    cancelarForm('torneo');
                    loadTabData('torneos');
                } else {
                    const error = await response.json();
                    alert('Error: ' + error.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function guardarTipoCancha(event) {
            event.preventDefault();
            
            const tipo = document.getElementById('tipo-cancha-nombre').value;
            
            const errores = [];
            
            const errorTipo = Validaciones.esTextoValido(tipo, 'Tipo de cancha', 3, 50);
            if (errorTipo) errores.push(errorTipo);
            
            if (Validaciones.mostrarErrores(errores)) return;
            
            const data = {
                tipo: tipo.trim()
            };
            try {
                const response = await fetch('/api/tipos-cancha', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                if (response.ok) {
                    alert('Tipo de cancha agregado exitosamente');
                    cancelarForm('tipo-cancha');
                    loadTabData('tipos-cancha');
                } else {
                    const error = await response.json();
                    alert('Error: ' + error.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function guardarServicio(event) {
            event.preventDefault();
            
            const servicio = document.getElementById('servicio-nombre').value;
            const costo = document.getElementById('servicio-costo').value;
            
            const errores = [];
            
            const errorServicio = Validaciones.esTextoValido(servicio, 'Nombre del servicio', 3, 100);
            if (errorServicio) errores.push(errorServicio);
            
            const errorCosto = Validaciones.esNumeroPositivo(costo, 'Costo');
            if (errorCosto) errores.push(errorCosto);
            
            if (Validaciones.mostrarErrores(errores)) return;
            
            const data = {
                servicio: servicio.trim(),
                costo: parseFloat(costo)
            };
            try {
                const response = await fetch('/api/servicios', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                if (response.ok) {
                    alert('Servicio agregado exitosamente');
                    cancelarForm('servicio');
                    loadTabData('servicios');
                } else {
                    const error = await response.json();
                    alert('Error: ' + error.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function guardarMetodoPago(event) {
            event.preventDefault();
            
            const metodo = document.getElementById('metodo-pago-nombre').value;
            
            const errores = [];
            
            const errorMetodo = Validaciones.esTextoValido(metodo, 'M√©todo de pago', 3, 50);
            if (errorMetodo) errores.push(errorMetodo);
            
            if (Validaciones.mostrarErrores(errores)) return;
            
            const data = {
                metodo: metodo.trim()
            };
            try {
                const response = await fetch('/api/metodos-pago', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                if (response.ok) {
                    alert('M√©todo de pago agregado exitosamente');
                    cancelarForm('metodo-pago');
                    loadTabData('metodos-pago');
                } else {
                    const error = await response.json();
                    alert('Error: ' + error.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // Funciones de eliminaci√≥n
        async function eliminarCliente(dni) {
            if (!confirm('¬øEst√° seguro de eliminar este cliente?')) return;
            try {
                const response = await fetch(`/api/clientes/${dni}`, {method: 'DELETE'});
                if (response.ok) {
                    alert('Cliente eliminado exitosamente');
                    loadTabData('clientes');
                } else {
                    const error = await response.json();
                    alert('Error: ' + error.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function eliminarCancha(nro) {
            if (!confirm('¬øEst√° seguro de eliminar esta cancha?')) return;
            try {
                const response = await fetch(`/api/canchas/${nro}`, {method: 'DELETE'});
                if (response.ok) {
                    alert('Cancha eliminada exitosamente');
                    loadTabData('canchas');
                } else {
                    const error = await response.json();
                    alert('Error: ' + error.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function eliminarReserva(nro) {
            if (!confirm('¬øEst√° seguro de eliminar esta reserva?')) return;
            try {
                const response = await fetch(`/api/reservas/${nro}`, {method: 'DELETE'});
                if (response.ok) {
                    alert('Reserva eliminada exitosamente');
                    loadTabData('reservas');
                } else {
                    const error = await response.json();
                    alert('Error: ' + error.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function eliminarTorneo(id) {
            if (!confirm('¬øEst√° seguro de eliminar este torneo?')) return;
            try {
                const response = await fetch(`/api/torneos/${id}`, {method: 'DELETE'});
                if (response.ok) {
                    alert('Torneo eliminado exitosamente');
                    loadTabData('torneos');
                } else {
                    const error = await response.json();
                    alert('Error: ' + error.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // Cargar datos iniciales
        window.onload = function() {
            loadTabData('clientes');
        };
    </script>
</body>
</html>

